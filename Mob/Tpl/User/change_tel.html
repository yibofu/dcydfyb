<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>更换手机号码</title>
    <meta name="keywords" content="滴滴快贷，更换手机号">
    <meta name="description" content="滴滴快贷更换手机号。">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="/Public/Mob/yh/css/font-awesome.min.css"/>
    <link rel="stylesheet" type="text/css" href="/Public/Mob/yh/css/20151123style.css" media="all">
    <link rel="stylesheet" href="/Public/Mob/yh/css/set.css"/>
	<script src="/Public/Mob/js/jquery-1.11.3.min.js"></script>
    <style>
        .telyzm{
            width: 106px;
            height: 30px;
            position: absolute;
            top: 3px;
            right:0;
        }
        .telyzm_x{
            background: #ee3200;
            height: 30px;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
        }
        .telyzm_x a{
            display: block;
            width: 100%;
            line-height: 30px;
            font-size: 14px;
            text-align: center;
            color: #ffffff;
        }
        @media screen and  (max-width: 360px){
            .dd_index form input{
                font-size: 14px;
                padding-right: 106px;
            }
            .telyzm{
                width: 106px;
                height: 30px;
                position: absolute;
                top: 3px;
                right:0;
            }
            .telyzm_x{
                background: #ee3200;
                height: 30px;
                -webkit-border-radius: 3px;
                -moz-border-radius: 3px;
                border-radius: 3px;
            }
            .telyzm_x a{
                display: block;
                width: 100%;
                line-height: 30px;
                font-size: 12px;
                text-align: center;
                color: #ffffff;
            }
        }
        .dd_yzm_again{
            background: #CCC8C8;
            width: 100%;
            height: 30px;
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
        }
        .dd_yzm_again a{
            display: block;
            text-align: center;
            line-height: 30px;
            color: #ffffff;
            font-size: 14px;
        }
        .dd_yzm_again a i{
            font-style: normal;

        }
		 /*浮层样式*/
        .shadowBox{
            width: 100%;
            height: 100%;
            max-width: 640px;
            margin: 0 auto;
            overflow: hidden;
            position: fixed;
            /*left: 0;*/
            top: 0;
            z-index: 50;
            background: rgba(0, 0, 0, 0.8);
			display:none;
        }
        .wrapBox{
            width: 80%;
            /*height: 40%;*/
            position: absolute;
            top: 20%;
            left: 50%;
            margin-left: -40%;
            -webkit-box-shadow: 0 0 4px #000000;
            -moz-box-shadow: 0 0 4px #000000;
            box-shadow: 0 0 4px #000000;
            background: #ffffff;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;
        }
        .wrapBox p{
            padding: 10px;
        }
        .wrapBox p:last-of-type{
            margin-bottom: 40px;
        }
        .wrapBox .shadowBtn {
            position: relative;
            width: 100%;
        }
        .wrapBox .shadowBtn .Btn_container{
            width: 80%;
            padding-bottom: 30px;
            margin: 0 auto;

        }
        .wrapBox .shadowBtn .Btn_container:after{
            content: '';
            display: block;
            height: 0;
            clear: both;
        }
        .wrapBox .shadowBtn span{
            display: block;
            width: 45%;
            background: #ee3200;
            margin-right: 5%;
            text-align: center;
            float: left;
            line-height: 2.2;
            color: #ffffff;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
        }
        /*浮层样式*/
	</style>
</head>
<body class="mhome">
<header class="dd_header">更换手机号码<span class="fa fa-chevron-left dd_return" onclick="return_page()"></span></header>
    <section class="dd_index dd_index2">
        <form action="#"method="post">
            <div class="input_box">
                <span class="input_text">原手机号</span><input type="text" readonly value="{$phone}" id="tel" name="tel" />
            </div>
            <div class="input_box">
                <span class="input_text">登录密码</span><input type="text" placeholder="请输入密码" id="pwd" name="pwd" />
            </div>
            <div class="input_box">
                <span class="input_text">新手机号</span><input type="text" max-length="11" placeholder="请确认新手机号" id="new_tel" name="new_tel" />
                <div class="telyzm">
                    <div class="telyzm_x" onclick="get_code(this)" style="display: block;">
                        <a href="javascript:;">获取短信验证码</a>
                    </div>
					 <div class="dd_yzm_again" style="display:none;" id="got_code"><a href="javascript:;"><i id="second">60</i>s后重新验证</a></div>
                </div>
            </div>
            <div class="input_box">
                <input type="text" name="mess" placeholder="请输入短信验证码" style="padding-left: 11px;" name="mess" id="mess"/>
            </div>
        </form>
    </section>
	<input type="hidden" name="imei" id="imei" />
<div class="dd_yzm" onclick="sub()"><a href="javascript:;">确定</a></div>
<div class="shadowBox">
    <section class="wrapBox">
        <p>&nbsp;</p>
        <p id="word" style="text-align:center;">浮层内容</p>
        <p>&nbsp;</p>
        <div class="shadowBtn">
            <div class="Btn_container">
                <span>确定</span>
                <span>取消</span>
            </div>
        </div>
    </section>
</div>
</body>
<script>
	var shadow=document.getElementsByClassName("shadowBox")[0];
	var btns=shadow.getElementsByClassName("shadowBtn")[0].getElementsByTagName("span");
	for(var i=0;i<btns.length;i++){
			btns[i].onclick=function(){
				shadow.style.display="none";
				flag=true;
			};
	}
	var imei = window.didikd.getImei();
	$("#imei").val(imei);
	function get_code(dom){
		var new_tel = $("#new_tel").val();
		var imei = $("#imei").val();
		if(new_tel == ''){
			$("#word").html('请填写手机号!');
			shadow.style.display="block";
			$("#new_tel").focus();
			return;
		}
		var new_time = 60;
		$.ajax({ 
				type: "POST", 
				url: '{:U("Index/send_message_tel")}',
				data:{'mobile':new_tel,'imei':imei},
				success:function(data){
					var data = eval("("+data+")");
					if(data.error){
						$("#word").html(data.message);
						shadow.style.display="block";
						$("#got_code").show();
						$(dom).hide();
						var a = setInterval(function(){
							new_time = new_time - 1;
							if(new_time == 0){
								new_time = 0;
								clearInterval(a);
								new_time = 60;
								$("#got_code").hide();
								$(dom).show();
							}
							$("#second").html(new_time);
						},1000);
					}else{
						$("#word").html(data.message);
						shadow.style.display="block";
						$("#new_tel").val('');
						return;
					}
				}
		});	
	}
	
	function sub(){
		var mess = $("#mess").val();
		var phone = $("#new_tel").val();
		var pwd = $("#pwd").val();
		if(pwd == ''){
			$("#word").html('密码不能为空!');
			shadow.style.display="block";
			$('#pwd').focus();
			return;
		}
		if(phone == ''){
			$("#word").html('请填写手机号!');
			shadow.style.display="block";
			$("#new_tel").val('');
			return;
		}
		if(mess == ''){
			$("#word").html('请填写验证码!');
			shadow.style.display="block";
			$("#mess").val('');
			return;
		}
		$.ajax({ 
				type: "POST", 
				url: "{:U('User/check_code',array('id'=>$id))}",
				data:{'mess':mess,'phone':phone,'pwd':pwd},
				success:function(data){
					var data = eval("("+data+")");
					if(data.error == 1){
						window.location.href = "{:U('Index/login')}";
					}else if(data.error == 2){
						$("#word").html(data.message);
						shadow.style.display="block";
						$("#mess").val('');
					}else if(data.error == 4){
						$("#word").html(data.message);
						shadow.style.display="block";
						$("#pwd").val("");
					}else{
						$("#word").html(data.message);
						shadow.style.display="block";
					}
				}
		});
	}
	function return_page(){
		window.location.href = "{:U('User/index')}";
	}
</script>
</html>